{% load static %} 

<!DOCTYPE html>
<html lang="no">
<head>
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check PDF accessibility</title>
</head>
<body>
    <div id="#header-main">
        Tingtun PDF checker
    </div>
    <div class="wrapper">
        <h2>Check by URL</h2>
        <input type="url" id="urlInput">
        <label for="urlInput" id="customUrlBtn">ðŸ“‚ Check</label>
        <h2>Check by file upload</h2>
        <input type="file" id="fileInput" accept="application/pdf">
        <label for="fileInput" id="customFileBtn">ðŸ“‚ Velg en PDF</label>

        <div hidden="true" id="result" class="result-container"></div>
    </div>
    
<br><br>

<iframe id="pdfViewer" width="50%" height="450px"></iframe>
<br>

<!-- Button container -->
<div class="button-container">
    <button id="removeBtn">ðŸ—‘ Fjern PDF</button>
    <button id="scanBtn">ðŸ“„ Scan PDF</button>
</div>

<script>
    // Trigger file input on custom button click
    document.getElementById('customFileBtn').addEventListener('click', function() {
        document.getElementById('fileInput').click(); // Trigger file input on custom label click
    });

    document.getElementById('customUrlBtn').addEventListener('click', function() {
    const urlInput = document.getElementById('urlInput');
    const urlValue = urlInput.value;

    if (!urlValue) {
        alert("Please enter a valid URL.");
        return;
    }

    const payload = {
        pdf_url: urlValue,
        // password: "optional" // include if needed
    };

    fetch("/api/check-pdf/", {  // Adjust if you're using a different route
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify(payload)
    })
    .then(response => response.json())
    .then(data => {
    const resultContainer = document.getElementById("result");
    resultContainer.innerHTML = ""; // Clear previous results

    const title = document.createElement("h3");
    title.textContent = "Accessibility Report:";

    const pre = document.createElement("pre");
    pre.textContent = JSON.stringify(data, null, 2); // Pretty-print JSON

    resultContainer.appendChild(title);
    resultContainer.appendChild(pre);
    resultContainer.removeAttribute("hidden");

    // Optional: Scroll to result
    window.scrollTo({
        top: document.body.scrollHeight,
        behavior: 'smooth'
    });
})

    .catch(error => {
        console.error("Error:", error);
    });
});
</script>

</body>
</html>
